<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Visitantes - Joffroy</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: white;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0;
        }

        .registro-container {
            background: white;
            width: 100%;
            max-width: 100%;
            min-height: 100vh;
            overflow: hidden;
            position: relative;
        }

        /* Header con hora */
        .header {
            background: #1e3a8a;
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .time {
            font-size: 16px;
            font-weight: 600;
        }

        .logo {
            font-size: 20px;
            font-weight: bold;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            color: white;
        }

        /* Progress bar */
        .progress-container {
            padding: 15px 20px 10px;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
        }

        .progress-bar {
            display: flex;
            justify-content: space-between;
            position: relative;
            margin-bottom: 10px;
        }

        .progress-line {
            position: absolute;
            top: 15px;
            left: 0;
            right: 0;
            height: 4px;
            background: #e0e0e0;
            z-index: 1;
        }

        .progress-completed {
            position: absolute;
            top: 15px;
            left: 0;
            height: 4px;
            background: #28a745;
            z-index: 2;
            transition: width 0.3s ease;
            width: 0%;
        }

        .progress-step {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            position: relative;
            z-index: 3;
            transition: all 0.3s ease;
            border: 2px solid white;
            font-size: 12px;
        }

            .progress-step.active {
                background: #1e3a8a;
                transform: scale(1.1);
            }

            .progress-step.completed {
                background: #28a745;
            }

        /* Contenido de los pasos */
        .step {
            display: none;
            padding: 30px 20px;
            min-height: calc(100vh - 140px);
        }

            .step.active {
                display: block;
                animation: fadeIn 0.5s ease;
            }

        .step-content {
            max-width: 100%;
            margin: 0 auto;
            text-align: center;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .step-title {
            font-size: 24px;
            color: #1e3a8a;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .step-subtitle {
            color: #666;
            margin-bottom: 25px;
            font-size: 16px;
            line-height: 1.5;
        }

        /* Formularios */
        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            background: #f8f9fa;
        }

            .form-input:focus {
                outline: none;
                border-color: #4dabf7;
                background: white;
            }

        .form-select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            background: #f8f9fa;
        }

        /* Área de foto */
        .photo-container {
            width: 180px;
            height: 180px;
            margin: 0 auto 25px;
            border: 3px dashed #ddd;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f9fa;
            cursor: pointer;
            overflow: hidden;
            position: relative;
        }

            .photo-container:hover {
                border-color: #4dabf7;
            }

        .photo-preview {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: none;
        }

        .photo-placeholder {
            text-align: center;
            color: #666;
        }

            .photo-placeholder i {
                font-size: 40px;
                margin-bottom: 10px;
                color: #4dabf7;
            }

        .photo-text {
            font-size: 14px;
        }

        /* Área de firma */
        .signature-container {
            border: 2px dashed #ddd;
            border-radius: 10px;
            padding: 15px;
            background: #f8f9fa;
            margin-bottom: 20px;
            text-align: center;
        }

        .signature-title {
            font-size: 16px;
            color: #333;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .signature-canvas {
            width: 100%;
            height: 150px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 8px;
            cursor: crosshair;
            touch-action: none;
            display: block;
        }

        .signature-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }

        .btn-clear {
            background: #dc3545;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

            .btn-clear:hover {
                background: #c82333;
            }

        .signature-notice {
            font-size: 12px;
            color: #666;
            margin-top: 10px;
            font-style: italic;
        }

        /* Botones */
        .btn-container {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: auto;
            padding-top: 20px;
        }

        .btn {
            padding: 15px 20px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            min-height: 50px;
        }

        .btn-primary {
            background: #4dabf7;
            color: white;
        }

            .btn-primary:hover {
                background: #3a9ae0;
            }

        .btn-secondary {
            background: #f8f9fa;
            color: #666;
            border: 2px solid #e0e0e0;
        }

            .btn-secondary:hover {
                background: #e9ecef;
            }

        /* Pantalla de confirmación */
        .confirmation-container {
            text-align: center;
            padding: 30px 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            height: 100%;
        }

        .confirmation-icon {
            width: 70px;
            height: 70px;
            background: #28a745;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            color: white;
            font-size: 30px;
        }

        .confirmation-title {
            font-size: 22px;
            color: #1e3a8a;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .confirmation-message {
            color: #666;
            font-size: 16px;
            line-height: 1.5;
            margin-bottom: 30px;
        }

        .host-name {
            color: #1e3a8a;
            font-weight: 600;
        }

        /* Cámara */
        .camera-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: black;
            z-index: 1000;
            display: none;
        }

        .camera-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .camera-controls {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
        }

        .camera-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            background: white;
            color: #333;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .camera-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 18px;
            cursor: pointer;
        }

        /* Estilos para el acuerdo de confidencialidad */
        .confidentiality-agreement {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: #f8f9fa;
            margin-bottom: 25px;
            max-height: 400px;
            overflow-y: auto;
            padding: 0;
        }

        .agreement-header {
            background: #1e3a8a;
            color: white;
            padding: 20px;
            text-align: center;
            border-radius: 8px 8px 0 0;
        }

            .agreement-header h3 {
                font-size: 18px;
                margin-bottom: 5px;
                font-weight: 600;
            }

        .company-name {
            font-size: 14px;
            opacity: 0.9;
        }

        .agreement-content {
            padding: 20px;
        }

        .agreement-section {
            margin-bottom: 20px;
        }

            .agreement-section h4 {
                color: #1e3a8a;
                font-size: 14px;
                margin-bottom: 8px;
                font-weight: 600;
            }

            .agreement-section p {
                font-size: 13px;
                line-height: 1.5;
                color: #333;
                margin-bottom: 8px;
                text-align: justify;
            }

        .agreement-intro {
            font-style: italic;
            background: #fff;
            padding: 10px;
            border-radius: 5px;
            border-left: 3px solid #1e3a8a;
        }

        .agreement-note {
            background: #fff3cd;
            padding: 8px 12px;
            border-radius: 5px;
            border-left: 3px solid #ffc107;
            font-size: 12px !important;
        }

        .agreement-list {
            margin: 10px 0;
            padding-left: 20px;
        }

            .agreement-list li {
                font-size: 13px;
                line-height: 1.5;
                color: #333;
                margin-bottom: 5px;
            }

        .agreement-signature-data {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }

        .signature-info {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .signature-field {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .field-label {
            font-weight: 600;
            color: #333;
            min-width: 120px;
            font-size: 13px;
        }

        .field-value {
            color: #666;
            font-size: 13px;
            flex: 1;
        }

        .name-value {
            color: #1e3a8a;
            font-weight: 600;
        }

        /* Scroll personalizado para el acuerdo */
        .confidentiality-agreement::-webkit-scrollbar {
            width: 6px;
        }

        .confidentiality-agreement::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }

        .confidentiality-agreement::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }

            .confidentiality-agreement::-webkit-scrollbar-thumb:hover {
                background: #a8a8a8;
            }

        /* Estilos para la etiqueta (oculta) */
        .etiqueta-print {
            display: none;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Media queries para tabletas */
        @media (min-width: 768px) and (max-width: 1024px) {
            .registro-container {
                max-width: 600px;
                margin: 20px auto;
                border-radius: 15px;
                box-shadow: 0 5px 20px rgba(0,0,0,0.1);
                min-height: auto;
            }

            .step {
                min-height: 500px;
            }

            .header {
                border-radius: 15px 15px 0 0;
            }
        }

        /* Media queries para móviles pequeños */
        @media (max-width: 480px) {
            .header {
                padding: 15px;
            }

            .progress-container {
                padding: 10px 15px 5px;
            }

            .step {
                padding: 20px 15px;
                min-height: calc(100vh - 120px);
            }

            .step-title {
                font-size: 22px;
            }

            .photo-container {
                width: 150px;
                height: 150px;
            }

            .btn {
                padding: 12px 15px;
                font-size: 15px;
            }

            .progress-step {
                width: 26px;
                height: 26px;
                font-size: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="registro-container">
        <!-- Barra de progreso -->
        <div class="progress-container">
            <div class="progress-bar" id="progressBar">
                <div class="progress-line"></div>
                <div class="progress-completed" id="progressCompleted"></div>

                <div class="progress-step completed" data-step="1">✓</div>
                <div class="progress-step completed" data-step="2">✓</div>
                <div class="progress-step active" data-step="3">3</div>
                <div class="progress-step" data-step="4">4</div>
                <div class="progress-step" data-step="5">5</div>
                <div class="progress-step" data-step="6">6</div>
            </div>
        </div>

        <!-- Header -->
        <div class="header">
            <div class="time" id="currentTime"></div>
            <div class="logo">Joffroy®</div>
        </div>

        <!-- Paso 1: Bienvenida -->
        <div class="step active" id="step-welcome" data-step="1">
            <div class="step-content">
                <h2 class="step-title">Bienvenido a Joffroy</h2>
                <p class="step-subtitle">Por favor ingresa tu información para comenzar el registro</p>

                <div class="form-group">
                    <label class="form-label">Nombre Completo *</label>
                    <input type="text" class="form-input" placeholder="Ingresa tu nombre" id="nombre">
                </div>

                <div class="btn-container">
                    <button class="btn btn-primary" onclick="nextStep('step-sucursal')">
                        Continuar <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Paso 2: Selección de Sucursal -->
        <div class="step" id="step-sucursal" data-step="2">
            <div class="step-content">
                <h2 class="step-title">Selección de Sucursal</h2>
                <p class="step-subtitle">Selecciona la sucursal que visitas</p>

                <div class="form-group">
                    <label class="form-label">Sucursal *</label>
                    <select class="form-select" id="sucursal" onchange="updateAnfitriones()">
                        <option value="">Selecciona una sucursal</option>
                        <option value="sucursal_centro">Sucursal Centro</option>
                        <option value="sucursal_norte">Sucursal Norte</option>
                        <option value="sucursal_sur">Sucursal Sur</option>
                        <option value="sucursal_este">Sucursal Este</option>
                    </select>
                </div>

                <div class="btn-container">
                    <button class="btn btn-secondary" onclick="prevStep('step-welcome')">
                        <i class="fas fa-arrow-left"></i> Atrás
                    </button>
                    <button class="btn btn-primary" onclick="nextStep('step-datos')">
                        Continuar <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Paso 3: Datos Personales -->
        <div class="step" id="step-datos" data-step="3">
            <div class="step-content">
                <h2 class="step-title">Datos Personales</h2>
                <p class="step-subtitle">Completa tu información personal</p>

                <div class="form-group">
                    <label class="form-label">Tu dirección de correo electrónico</label>
                    <input type="email" class="form-input" placeholder="Ingresa tu correo" id="email">
                </div>

                <div class="form-group">
                    <label class="form-label">Tu número de teléfono</label>
                    <input type="tel" class="form-input" placeholder="Ingresa tu número" id="telefono">
                </div>

                <div class="btn-container">
                    <button class="btn btn-secondary" onclick="prevStep('step-sucursal')">
                        <i class="fas fa-arrow-left"></i> Atrás
                    </button>
                    <button class="btn btn-primary" onclick="nextStep('step-motivo')">
                        Continuar <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Paso 4: Motivo de la Visita -->
        <div class="step" id="step-motivo" data-step="4">
            <div class="step-content">
                <h2 class="step-title">Detalles de la Visita</h2>
                <p class="step-subtitle">Información sobre tu visita</p>

                <div class="form-group">
                    <label class="form-label">Empresa de procedencia</label>
                    <input type="text" class="form-input" placeholder="Ingresa tu empresa" id="empresa">
                </div>

                <div class="form-group">
                    <label class="form-label">Motivo de la visita</label>
                    <select class="form-select" id="motivo">
                        <option value="">Selecciona un motivo</option>
                        <option value="reunion">Reunión de negocios</option>
                        <option value="entrevista">Entrevista</option>
                        <option value="entrega">Entrega de documentos</option>
                        <option value="capacitacion">Capacitación</option>
                        <option value="otro">Otro</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Anfitrión *</label>
                    <select class="form-select" id="anfitrion">
                        <option value="">Selecciona un anfitrión</option>
                    </select>
                </div>

                <div class="btn-container">
                    <button class="btn btn-secondary" onclick="prevStep('step-datos')">
                        <i class="fas fa-arrow-left"></i> Atrás
                    </button>
                    <button class="btn btn-primary" onclick="nextStep('step-foto')">
                        Continuar <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Paso 5: Foto -->
        <div class="step" id="step-foto" data-step="5">
            <div class="step-content">
                <h2 class="step-title">Agregar Foto</h2>
                <p class="step-subtitle">Toma una foto para completar tu registro</p>

                <div class="photo-container" onclick="openCamera()">
                    <div class="photo-placeholder">
                        <i class="fas fa-camera"></i>
                        <div class="photo-text">Haz clic para tomar foto</div>
                    </div>
                    <img id="photoPreview" class="photo-preview" alt="Vista previa de foto">
                </div>

                <div class="btn-container">
                    <button class="btn btn-secondary" onclick="prevStep('step-motivo')">
                        <i class="fas fa-arrow-left"></i> Atrás
                    </button>
                    <button class="btn btn-primary" onclick="nextStep('step-firma')">
                        Continuar <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Paso 6: Firma -->
        <div class="step" id="step-firma" data-step="6">
            <div class="step-content">
                <h2 class="step-title">Acuerdo de Confidencialidad</h2>
                <p class="step-subtitle">Lee y firma el siguiente acuerdo</p>

                <!-- Contenedor del acuerdo -->
                <div class="confidentiality-agreement">
                    <div class="agreement-header">
                        <h3>ACUERDO DE CONFIDENCIALIDAD PARA VISITANTES</h3>
                        <p class="company-name">EMPRESAS JOFFROY Y COMPAÑÍA S.C. (en adelante "JOFFROY")</p>
                    </div>

                    <div class="agreement-content">
                        <div class="agreement-section">
                            <p class="agreement-intro">
                                solicita a todo visitante que, por motivo de ingreso a sus instalaciones o participación en reuniones,
                                firme el presente Acuerdo de Confidencialidad, mediante el cual se compromete a respetar los lineamientos
                                de confidencialidad establecidos por la empresa y su grupo corporativo.
                            </p>
                        </div>

                        <div class="agreement-section">
                            <h4>1. Definición de Información Confidencial</h4>
                            <p>
                                Se considera Información Confidencial toda aquella información técnica, operativa, comercial,
                                financiera o legal perteneciente a JOFFROY, sus clientes o empresas del grupo, así como cualquier
                                dato, imagen, documento o conversación a la que el visitante tenga acceso durante su estancia.
                            </p>
                            <p class="agreement-note">
                                Esta información incluye, pero no se limita a: procedimientos internos, estrategias de negocio,
                                información de clientes, proveedores, empleados, contraseñas, listas de precios, proyectos o
                                cualquier dato no público.
                            </p>
                        </div>

                        <div class="agreement-section">
                            <h4>2. Obligación de Confidencialidad</h4>
                            <p>
                                El visitante se compromete a no divulgar, copiar o reproducir información obtenida durante su visita,
                                ni a utilizarla directa o indirectamente para beneficio propio o de terceros.
                            </p>
                            <p class="agreement-note">
                                El deber de confidencialidad permanece vigente incluso después de terminada la visita o relación con JOFFROY.
                            </p>
                        </div>

                        <div class="agreement-section">
                            <h4>3. Protección y Cuidado</h4>
                            <p>El visitante deberá:</p>
                            <ul class="agreement-list">
                                <li>Evitar compartir información con personas ajenas a JOFFROY.</li>
                                <li>No tomar fotografías, grabar audio o video sin autorización escrita.</li>
                                <li>Reportar a JOFFROY cualquier incidente de divulgación o pérdida de información.</li>
                            </ul>
                        </div>

                        <div class="agreement-section">
                            <h4>4. Propiedad de la Información</h4>
                            <p>
                                Toda la información a la que el visitante tenga acceso es propiedad exclusiva de JOFFROY o sus clientes.
                                Este documento no otorga ningún derecho de uso o licencia sobre dicha información.
                            </p>
                        </div>

                        <div class="agreement-section">
                            <h4>5. Consecuencias de Incumplimiento</h4>
                            <p>
                                El visitante reconoce que cualquier uso o divulgación indebida de información confidencial podrá
                                ocasionar daños y perjuicios a JOFFROY, susceptibles de acciones legales conforme a las leyes
                                mexicanas aplicables.
                            </p>
                        </div>

                        <div class="agreement-section">
                            <h4>6. Vigencia</h4>
                            <p>
                                Este acuerdo entra en vigor a partir de la fecha de firma y permanecerá vigente durante y después
                                de la visita, sin límite de tiempo.
                            </p>
                        </div>

                        <!-- Datos del visitante para el PDF -->
                        <div class="agreement-signature-data">
                            <div class="signature-info">
                                <div class="signature-field">
                                    <span class="field-label">Lugar:</span>
                                    <span class="field-value">Nogales, Sonora</span>
                                </div>
                                <div class="signature-field">
                                    <span class="field-label">Fecha:</span>
                                    <span class="field-value" id="currentDate"></span>
                                </div>
                                <div class="signature-field">
                                    <span class="field-label">Nombre Completo:</span>
                                    <span class="field-value name-value" id="nombreAcuerdo">________________________________</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Área de firma digital -->
                <div class="signature-container">
                    <div class="signature-title">Firma Digital del Visitante *</div>
                    <canvas id="signatureCanvas" class="signature-canvas"></canvas>
                    <div class="signature-actions">
                        <button class="btn-clear" onclick="clearSignature()">
                            <i class="fas fa-eraser"></i> Limpiar Firma
                        </button>
                    </div>
                    <div class="signature-notice">Haz clic y arrastra para firmar | Suelta para terminar</div>
                </div>

                <div class="btn-container">
                    <button class="btn btn-secondary" onclick="prevStep('step-foto')">
                        <i class="fas fa-arrow-left"></i> Atrás
                    </button>
                    <button class="btn btn-primary" onclick="nextStep('step-confirmacion')">
                        Aceptar y Continuar <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Paso 7: Confirmación -->
        <div class="step" id="step-confirmacion" data-step="7">
            <div class="step-content">
                <div class="confirmation-container">
                    <div class="confirmation-icon">
                        <i class="fas fa-check"></i>
                    </div>
                    <h2 class="confirmation-title" id="confirmacionTitulo">¡Bienvenido!</h2>
                    <p class="confirmation-message" id="confirmacionMensaje">
                        Hemos informado a <span class="host-name" id="anfitrionConfirmacion">Leslie Pacheco</span><br>
                        que estás aquí en la <span class="host-name" id="sucursalConfirmacion">Sucursal Centro</span>.
                    </p>

                    <div class="btn-container">
                        <button class="btn btn-primary" onclick="descargarEtiqueta()">
                            <i class="fas fa-download"></i> Descargar Etiqueta
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Cámara -->
        <div class="camera-container" id="cameraContainer">
            <video id="cameraVideo" class="camera-video" autoplay></video>
            <canvas id="cameraCanvas" style="display: none;"></canvas>
            <button class="camera-close" onclick="closeCamera()">
                <i class="fas fa-times"></i>
            </button>
            <div class="camera-controls">
                <button class="camera-btn" onclick="takePhoto()">
                    <i class="fas fa-camera"></i>
                </button>
            </div>
        </div>

        <!-- Etiqueta oculta para impresión -->
        <div id="etiquetaPrint" class="etiqueta-print">
            <div style="width: 400px; padding: 20px; font-family: Arial, sans-serif;">
                <div style="text-align: center; margin-bottom: 20px;">
                    <div style="font-size: 28px; font-weight: bold; color: #1e3a8a;">JOFFROY</div>
                    <div style="font-size: 16px; font-weight: 600;">VISITANTE</div>
                </div>

                <div style="height: 2px; background: #1e3a8a; margin: 15px 0;"></div>

                <div style="margin-bottom: 15px;">
                    <div style="font-size: 18px; font-weight: bold; margin-bottom: 5px;">NOMBRE</div>
                    <div style="font-size: 16px;" id="printNombre"></div>
                </div>

                <div style="margin-bottom: 10px;">
                    <div style="font-size: 14px; font-weight: 600; margin-bottom: 3px;">EMPRESA</div>
                    <div style="font-size: 16px;" id="printEmpresa"></div>
                </div>

                <div style="margin-bottom: 10px;">
                    <div style="font-size: 14px; font-weight: 600; margin-bottom: 3px;">MOTIVO</div>
                    <div style="font-size: 16px;" id="printMotivo"></div>
                </div>

                <div style="margin-bottom: 15px;">
                    <div style="font-size: 14px; font-weight: 600; margin-bottom: 3px;">ANFITRIÓN</div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="font-size: 16px; font-weight: 600;" id="printAnfitrion"></div>
                        <div style="font-size: 14px; font-weight: bold; color: #1e3a8a;" id="printCodigo"></div>
                    </div>
                </div>

                <div style="height: 2px; background: #1e3a8a; margin: 15px 0;"></div>

                <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #ddd;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <div style="font-size: 14px; font-weight: 600;" id="printFecha"></div>
                        <div style="font-size: 14px; font-weight: 600;" id="printHora"></div>
                    </div>
                    <div style="font-size: 14px; font-weight: 600; margin-bottom: 15px;" id="printSucursal"></div>

                    <div style="font-size: 12px; color: #666; line-height: 1.4; text-align: center; margin-top: 15px;">
                        • Use esta etiqueta durante su visita<br>
                        • Escanee el QR al salir<br>
                        • Devuelva la etiqueta en recepción
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let currentStep = 'step-welcome';
        let timeInterval;
        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;
        let signatureCtx = null;
        let stream = null;
        let isCameraOpen = false;

        // Datos del visitante
        const visitanteData = {
            nombre: '',
            sucursal: '',
            email: '',
            telefono: '',
            empresa: '',
            motivo: '',
            anfitrion: '',
            firma: '',
            foto: ''
        };

        // Datos de anfitriones por sucursal
        const anfitrionesPorSucursal = {
            'sucursal_centro': ['Leslie Pacheco', 'Lic. Ramírez', 'Ing. Torres'],
            'sucursal_norte': ['Dr. Mendoza', 'Lic. García', 'Ing. López'],
            'sucursal_sur': ['Lic. Hernández', 'Ing. Martínez', 'Dr. Rodríguez'],
            'sucursal_este': ['Ing. Pérez', 'Lic. González', 'Dr. Sánchez']
        };

        // Inicialización cuando carga la página
        document.addEventListener('DOMContentLoaded', function () {
            updateTime();
            timeInterval = setInterval(updateTime, 60000);
            initializeSignature();
            updateProgressBar(currentStep);
            updateCurrentDate();

            // Verificar que el input de nombre esté funcionando
            const nombreInput = document.getElementById('nombre');
            if (nombreInput) {
                nombreInput.addEventListener('input', function () {
                    visitanteData.nombre = this.value;
                });
            }
        });

        // Función para actualizar la hora
        function updateTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent =
                now.getHours() + ':' + now.getMinutes().toString().padStart(2, '0');
        }

        // Función para obtener la fecha actual
        function updateCurrentDate() {
            const today = new Date();
            const day = today.getDate().toString().padStart(2, '0');
            const month = (today.getMonth() + 1).toString().padStart(2, '0');
            const year = today.getFullYear();

            document.getElementById('currentDate').textContent = `${day} / ${month} / ${year}`;
        }

        // Navegación entre pasos
        function nextStep(nextStepId) {
            // GUARDAR PRIMERO los datos del paso actual
            saveStepData(currentStep);

            // LUEGO validar
            if (validateStep(currentStep)) {
                currentStep = nextStepId;
                updateProgressBar(nextStepId);

                if (nextStepId === 'step-confirmacion') {
                    updateConfirmation();
                }
            }
        }

        function prevStep(prevStepId) {
            currentStep = prevStepId;
            updateProgressBar(prevStepId);
        }

        // Actualizar anfitriones según la sucursal seleccionada
        function updateAnfitriones() {
            const sucursalSelect = document.getElementById('sucursal');
            const anfitrionSelect = document.getElementById('anfitrion');
            const sucursal = sucursalSelect.value;

            // Limpiar opciones actuales
            anfitrionSelect.innerHTML = '<option value="">Selecciona un anfitrión</option>';

            if (sucursal && anfitrionesPorSucursal[sucursal]) {
                anfitrionesPorSucursal[sucursal].forEach(anfitrion => {
                    const option = document.createElement('option');
                    option.value = anfitrion;
                    option.textContent = anfitrion;
                    anfitrionSelect.appendChild(option);
                });
            }
        }

        // Sistema de firma
        function initializeSignature() {
            const canvas = document.getElementById('signatureCanvas');
            signatureCtx = canvas.getContext('2d');

            setupSignatureCanvasSize();

            signatureCtx.lineWidth = 3;
            signatureCtx.lineJoin = 'round';
            signatureCtx.lineCap = 'round';
            signatureCtx.strokeStyle = '#000000';

            clearSignature();

            // Agregar event listeners para la firma
            canvas.addEventListener('mousedown', startSignatureDrawing);
            canvas.addEventListener('mousemove', drawSignature);
            canvas.addEventListener('mouseup', stopSignatureDrawing);
            canvas.addEventListener('mouseout', stopSignatureDrawing);

            canvas.addEventListener('touchstart', startSignatureDrawing);
            canvas.addEventListener('touchmove', drawSignature);
            canvas.addEventListener('touchend', stopSignatureDrawing);
        }

        function setupSignatureCanvasSize() {
            const canvas = document.getElementById('signatureCanvas');
            const containerWidth = canvas.parentElement.clientWidth || 300;
            canvas.width = containerWidth - 60;
            canvas.height = 150;
        }

        // Eventos de firma
        function startSignatureDrawing(event) {
            event.preventDefault();
            if (!signatureCtx) return;

            isDrawing = true;
            const pos = getSignatureCanvasPosition(event);
            [lastX, lastY] = [pos.x, pos.y];

            signatureCtx.beginPath();
            signatureCtx.moveTo(lastX, lastY);
        }

        function drawSignature(event) {
            if (!isDrawing || !signatureCtx) return;
            event.preventDefault();

            const pos = getSignatureCanvasPosition(event);
            const currentX = pos.x;
            const currentY = pos.y;

            signatureCtx.lineTo(currentX, currentY);
            signatureCtx.stroke();

            [lastX, lastY] = [currentX, currentY];
        }

        function stopSignatureDrawing() {
            isDrawing = false;
        }

        function getSignatureCanvasPosition(event) {
            const canvas = document.getElementById('signatureCanvas');
            const rect = canvas.getBoundingClientRect();

            if (event.type.includes('touch')) {
                return {
                    x: event.touches[0].clientX - rect.left,
                    y: event.touches[0].clientY - rect.top
                };
            } else {
                return {
                    x: event.clientX - rect.left,
                    y: event.clientY - rect.top
                };
            }
        }

        function clearSignature() {
            const canvas = document.getElementById('signatureCanvas');
            if (!signatureCtx) return;

            signatureCtx.fillStyle = 'white';
            signatureCtx.fillRect(0, 0, canvas.width, canvas.height);
            signatureCtx.beginPath();
        }

        function isSignatureDrawn() {
            const canvas = document.getElementById('signatureCanvas');
            if (!signatureCtx) return false;

            const imageData = signatureCtx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;

            for (let i = 0; i < data.length; i += 4) {
                if (data[i] !== 255 || data[i + 1] !== 255 || data[i + 2] !== 255) {
                    return true;
                }
            }
            return false;
        }

        // Sistema de progreso
        function updateProgressBar(stepId) {
            const steps = document.querySelectorAll('.progress-step');
            const progressCompleted = document.getElementById('progressCompleted');
            const currentStepElement = document.getElementById(stepId);

            // Ocultar todos los pasos
            document.querySelectorAll('.step').forEach(step => {
                step.classList.remove('active');
            });

            // Mostrar el paso actual
            if (currentStepElement) {
                currentStepElement.classList.add('active');
            }

            if (!progressCompleted) return;

            const stepNumber = parseInt(currentStepElement?.getAttribute('data-step') || '1');
            const totalSteps = steps.length;
            const completedWidth = ((stepNumber - 1) / (totalSteps - 1)) * 100;

            progressCompleted.style.width = completedWidth + '%';

            steps.forEach((step, index) => {
                const stepNum = parseInt(step.getAttribute('data-step') || '0');
                step.classList.remove('active', 'completed');

                if (stepNum < stepNumber) {
                    step.classList.add('completed');
                    step.innerHTML = '✓';
                } else if (stepNum === stepNumber) {
                    step.classList.add('active');
                    step.innerHTML = stepNum.toString();
                } else {
                    step.innerHTML = stepNum.toString();
                }
            });
        }

        // Sistema de cámara
        async function openCamera() {
            isCameraOpen = true;
            document.getElementById('cameraContainer').style.display = 'block';

            try {
                stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' } });
                const cameraVideo = document.getElementById('cameraVideo');
                cameraVideo.srcObject = stream;
            } catch (error) {
                console.error('Error al acceder a la cámara:', error);
                alert('No se pudo acceder a la cámara. Permite el acceso a la cámara en tu navegador.');
                closeCamera();
            }
        }

        function closeCamera() {
            isCameraOpen = false;
            document.getElementById('cameraContainer').style.display = 'none';

            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }

            const cameraVideo = document.getElementById('cameraVideo');
            if (cameraVideo) {
                cameraVideo.srcObject = null;
            }
        }

        function takePhoto() {
            const video = document.getElementById('cameraVideo');
            const canvas = document.getElementById('cameraCanvas');
            const context = canvas.getContext('2d');
            const photoPreview = document.getElementById('photoPreview');

            if (!context) return;

            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;

            context.drawImage(video, 0, 0, canvas.width, canvas.height);

            visitanteData.foto = canvas.toDataURL('image/png');
            photoPreview.src = visitanteData.foto;
            photoPreview.style.display = 'block';

            document.querySelector('.photo-placeholder').style.display = 'none';

            closeCamera();
        }

        // Validación y guardado de datos
        function saveStepData(stepId) {
            switch (stepId) {
                case 'step-welcome':
                    visitanteData.nombre = document.getElementById('nombre').value;
                    break;
                case 'step-sucursal':
                    visitanteData.sucursal = document.getElementById('sucursal').value;
                    break;
                case 'step-datos':
                    visitanteData.email = document.getElementById('email').value;
                    visitanteData.telefono = document.getElementById('telefono').value;
                    break;
                case 'step-motivo':
                    visitanteData.empresa = document.getElementById('empresa').value;
                    visitanteData.motivo = document.getElementById('motivo').value;
                    visitanteData.anfitrion = document.getElementById('anfitrion').value;
                    break;
                case 'step-firma':
                    if (signatureCtx) {
                        visitanteData.firma = document.getElementById('signatureCanvas').toDataURL('image/png');
                    }
                    break;
            }
        }

        function validateStep(stepId) {
            switch (stepId) {
                case 'step-welcome':
                    if (!visitanteData.nombre?.trim()) {
                        alert('Por favor ingresa tu nombre completo');
                        return false;
                    }
                    break;
                case 'step-sucursal':
                    if (!visitanteData.sucursal) {
                        alert('Por favor selecciona una sucursal');
                        return false;
                    }
                    break;
                case 'step-datos':
                    if (!visitanteData.email?.trim() && !visitanteData.telefono?.trim()) {
                        alert('Por favor ingresa al menos un método de contacto (email o teléfono)');
                        return false;
                    }
                    break;
                case 'step-motivo':
                    if (!visitanteData.anfitrion) {
                        alert('Por favor selecciona un anfitrión');
                        return false;
                    }
                    if (!visitanteData.motivo) {
                        alert('Por favor selecciona un motivo de la visita');
                        return false;
                    }
                    break;
                case 'step-foto':
                    if (!visitanteData.foto) {
                        alert('Por favor toma una foto antes de continuar');
                        return false;
                    }
                    break;
                case 'step-firma':
                    if (!isSignatureDrawn()) {
                        alert('Por favor dibuja tu firma antes de continuar');
                        return false;
                    }
                    break;
            }
            return true;
        }

        // Actualizar confirmación
        function updateConfirmation() {
            // Actualizar nombre en el acuerdo
            document.getElementById('nombreAcuerdo').textContent = visitanteData.nombre || '________________________________';

            // Actualizar pantalla de confirmación
            document.getElementById('confirmacionTitulo').textContent = `¡Bienvenido ${visitanteData.nombre || 'Nombre'}!`;

            // Actualizar anfitrión
            document.getElementById('anfitrionConfirmacion').textContent = visitanteData.anfitrion || 'Leslie Pacheco';

            // Actualizar sucursal
            const sucursalText =
                visitanteData.sucursal === 'sucursal_centro' ? 'Sucursal Centro' :
                    visitanteData.sucursal === 'sucursal_norte' ? 'Sucursal Norte' :
                        visitanteData.sucursal === 'sucursal_sur' ? 'Sucursal Sur' :
                            visitanteData.sucursal === 'sucursal_este' ? 'Sucursal Este' : 'la sucursal';

            document.getElementById('sucursalConfirmacion').textContent = sucursalText;
        }

        // Descargar etiqueta directamente
        function descargarEtiqueta() {
            // Llenar datos en la etiqueta oculta
            document.getElementById('printNombre').textContent = visitanteData.nombre || 'No especificado';
            document.getElementById('printEmpresa').textContent = visitanteData.empresa || 'No especificada';

            // Convertir motivo a texto legible
            const motivoText = {
                'reunion': 'Reunión de negocios',
                'entrevista': 'Entrevista',
                'entrega': 'Entrega de documentos',
                'capacitacion': 'Capacitación',
                'otro': 'Otro'
            }[visitanteData.motivo] || 'No especificado';

            document.getElementById('printMotivo').textContent = motivoText;
            document.getElementById('printAnfitrion').textContent = visitanteData.anfitrion || 'No especificado';

            // Fecha y hora actual
            const now = new Date();
            const fecha = now.toLocaleDateString();
            const hora = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            document.getElementById('printFecha').textContent = `FECHA: ${fecha}`;
            document.getElementById('printHora').textContent = `HORA: ${hora}`;

            // Sucursal
            const sucursalText =
                visitanteData.sucursal === 'sucursal_centro' ? 'Sucursal Centro' :
                    visitanteData.sucursal === 'sucursal_norte' ? 'Sucursal Norte' :
                        visitanteData.sucursal === 'sucursal_sur' ? 'Sucursal Sur' :
                            visitanteData.sucursal === 'sucursal_este' ? 'Sucursal Este' : 'No especificada';
            document.getElementById('printSucursal').textContent = sucursalText;

            // Generar código único
            const codigo = generarCodigoUnico();
            document.getElementById('printCodigo').textContent = `CÓDIGO SALIDA: ${codigo}`;

            // Crear ventana de impresión
            const ventanaImpresion = window.open('', '_blank');
            const contenido = `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>Etiqueta Visitante - Joffroy</title>
                        <style>
                            body {
                                margin: 0;
                                padding: 20px;
                                font-family: Arial, sans-serif;
                                display: flex;
                                justify-content: center;
                                align-items: center;
                                min-height: 100vh;
                            }
                            .etiqueta {
                                width: 400px;
                                border: 2px solid #1e3a8a;
                                border-radius: 10px;
                                padding: 25px;
                                background: white;
                            }
                            .logo {
                                font-size: 28px;
                                font-weight: bold;
                                color: #1e3a8a;
                                text-align: center;
                                margin-bottom: 5px;
                            }
                            .subtitle {
                                font-size: 16px;
                                font-weight: 600;
                                text-align: center;
                                margin-bottom: 15px;
                            }
                            .divider {
                                height: 2px;
                                background: #1e3a8a;
                                margin: 15px 0;
                            }
                            .section { margin-bottom: 15px; }
                            .section-title {
                                font-size: 18px;
                                font-weight: bold;
                                margin-bottom: 5px;
                            }
                            .section-subtitle {
                                font-size: 14px;
                                font-weight: 600;
                                margin-bottom: 3px;
                            }
                            .value { font-size: 16px; margin-bottom: 10px; padding-left: 10px; }
                            .anfitrion-container {
                                display: flex;
                                justify-content: space-between;
                                align-items: center;
                                margin: 15px 0;
                            }
                            .anfitrion-name { font-size: 16px; font-weight: 600; }
                            .codigo { font-size: 14px; font-weight: bold; color: #1e3a8a; }
                            .footer {
                                margin-top: 20px;
                                padding-top: 15px;
                                border-top: 1px solid #ddd;
                            }
                            .fecha-hora {
                                display: flex;
                                justify-content: space-between;
                                margin-bottom: 10px;
                            }
                            .fecha, .hora { font-size: 14px; font-weight: 600; }
                            .sucursal { font-size: 14px; font-weight: 600; margin-bottom: 15px; }
                            .instructions {
                                font-size: 12px;
                                color: #666;
                                line-height: 1.4;
                                text-align: center;
                                margin-top: 15px;
                            }
                            @media print {
                                body { margin: 0; padding: 0; }
                                .etiqueta { border: none; box-shadow: none; }
                            }
                        </style>
                    </head>
                    <body>
                        <div class="etiqueta">
                            <div class="logo">JOFFROY</div>
                            <div class="subtitle">VISITANTE</div>

                            <div class="divider"></div>

                            <div class="section">
                                <div class="section-title">NOMBRE</div>
                                <div class="value">${visitanteData.nombre || 'No especificado'}</div>
                            </div>

                            <div class="section">
                                <div class="section-subtitle">EMPRESA</div>
                                <div class="value">${visitanteData.empresa || 'No especificada'}</div>
                            </div>

                            <div class="section">
                                <div class="section-subtitle">MOTIVO</div>
                                <div class="value">${motivoText}</div>
                            </div>

                            <div class="section">
                                <div class="section-subtitle">ANFITRIÓN</div>
                                <div class="anfitrion-container">
                                    <div class="anfitrion-name">${visitanteData.anfitrion || 'No especificado'}</div>
                                    <div class="codigo">CÓDIGO SALIDA: ${codigo}</div>
                                </div>
                            </div>

                            <div class="divider"></div>

                            <div class="footer">
                                <div class="fecha-hora">
                                    <div class="fecha">FECHA: ${fecha}</div>
                                    <div class="hora">HORA: ${hora}</div>
                                </div>
                                <div class="sucursal">${sucursalText}</div>

                                <div class="instructions">
                                    • Use esta etiqueta durante su visita<br>
                                    • Escanee el QR al salir<br>
                                    • Devuelva la etiqueta en recepción
                                </div>
                            </div>
                        </div>
                        <script>
                            window.onload = function() {
                                window.print();
                                setTimeout(function() {
                                    window.close();
                                }, 1000);
                            };
                        <\/script>
                    </body>
                    </html>
                `;

            ventanaImpresion.document.write(contenido);
            ventanaImpresion.document.close();

            // Reiniciar formulario después de descargar
            setTimeout(() => {
                resetearFormularioCompleto();
            }, 2000);
        }

        function generarCodigoUnico() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < 8; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        // MÉTODO MEJORADO PARA RESETEO COMPLETO
        function resetearFormularioCompleto() {
            // 1. Cerrar cámara
            closeCamera();

            // 2. REINICIAR INMEDIATAMENTE EL PASO ACTUAL
            currentStep = 'step-welcome';

            // 3. Reiniciar datos
            visitanteData.nombre = '';
            visitanteData.sucursal = '';
            visitanteData.email = '';
            visitanteData.telefono = '';
            visitanteData.empresa = '';
            visitanteData.motivo = '';
            visitanteData.anfitrion = '';
            visitanteData.firma = '';
            visitanteData.foto = '';

            // 4. Limpiar formularios
            document.getElementById('nombre').value = '';
            document.getElementById('sucursal').value = '';
            document.getElementById('email').value = '';
            document.getElementById('telefono').value = '';
            document.getElementById('empresa').value = '';
            document.getElementById('motivo').value = '';
            document.getElementById('anfitrion').innerHTML = '<option value="">Selecciona un anfitrión</option>';

            // 5. Limpiar elementos visuales
            limpiarElementosVisuales();

            // 6. Actualizar progreso
            updateProgressBar('step-welcome');

            console.log('✅ Formulario completamente reiniciado - Mostrando paso 1');
        }

        function limpiarElementosVisuales() {
            // Limpiar foto preview
            const photoPreview = document.getElementById('photoPreview');
            photoPreview.style.display = 'none';
            photoPreview.src = '';

            // Mostrar placeholder de foto
            const photoPlaceholder = document.querySelector('.photo-placeholder');
            if (photoPlaceholder) {
                photoPlaceholder.style.display = 'flex';
            }

            // Limpiar firma
            clearSignature();

            // Limpiar nombre en el acuerdo
            document.getElementById('nombreAcuerdo').textContent = '________________________________';
        }

        // Redimensionar canvas cuando cambie el tamaño de la ventana
        window.addEventListener('resize', function () {
            setupSignatureCanvasSize();
            clearSignature();
        });
    </script>
</body>
</html>
